{% assign opportunity = include.opportunity %}
{% assign category = site.data.opportunities.categories | where: "id", opportunity.category | first %}
{% assign category_label = category.label | default: opportunity.category | replace: "-", " " | capitalize %}
{% assign category_icon = category.icon | default: "" %}
{% assign category_color = category.color | default: "neutral" %}
{% assign status = opportunity.status | default: "open" %}
{% assign status_label = status | replace: "_", " " | capitalize %}
{% assign status_variant = "info" %}
{% if status == "open" %}
    {% assign status_variant = "success" %}
{% elsif status == "filled" %}
    {% assign status_variant = "danger" %}
{% elsif status == "coming_soon" %}
    {% assign status_variant = "warning" %}
{% endif %}
{% assign action_label = "Learn more" %}
{% assign action_variant = "secondary" %}
{% if status == "open" %}
    {% assign action_label = "Apply" %}
    {% assign action_variant = "primary" %}
{% endif %}
{% assign contact = opportunity.contact %}
{% assign contact_href = contact %}
{% if contact and contact contains "@" %}
    {% unless contact contains "://" or contact contains "mailto:" %}
        {% assign contact_href = "mailto:" | append: contact %}
    {% endunless %}
{% endif %}

<article class="opportunity-card" data-category="{{ opportunity.category }}" data-status="{{ status }}">
    <div class="opportunity-card__header">
        <div class="opportunity-card__badges">
            <span class="cfl-badge cfl-badge--pill opportunity-category opportunity-category--{{ category_color }}">
                {% if category_icon != "" %}<span class="opportunity-category__icon" aria-hidden="true">{{ category_icon }}</span>{% endif %}
                <span class="opportunity-category__label">{{ category_label }}</span>
            </span>
            <span class="cfl-badge cfl-badge--pill cfl-badge--{{ status_variant }} opportunity-status">{{ status_label }}</span>
        </div>
        <h3 class="opportunity-card__title">{{ opportunity.title | escape }}</h3>
    </div>

    {% if opportunity.commitment or opportunity.contact %}
    <div class="opportunity-card__meta">
        {% if opportunity.commitment %}
        <span class="opportunity-card__meta-item">
            <span class="opportunity-card__meta-label">⏱</span>
            <span class="opportunity-card__meta-value">{{ opportunity.commitment }}</span>
        </span>
        {% endif %}
        {% if opportunity.contact %}
        <span class="opportunity-card__meta-item">
            <span class="opportunity-card__meta-label">✉</span>
            {% if contact_href %}<a class="opportunity-card__meta-link" href="{{ contact_href }}">{{ opportunity.contact }}</a>{% else %}<span class="opportunity-card__meta-value">{{ opportunity.contact }}</span>{% endif %}
        </span>
        {% endif %}
    </div>
    {% endif %}

    {% if opportunity.description %}
    <p class="opportunity-card__description">{{ opportunity.description }}</p>
    {% endif %}

    {% if opportunity.requirements and opportunity.requirements.size > 0 %}
    <ul class="opportunity-card__requirements">
        {% for requirement in opportunity.requirements %}
        <li>{{ requirement }}</li>
        {% endfor %}
    </ul>
    {% endif %}

    <div class="opportunity-card__actions">
        {% if opportunity.apply_url and status != "filled" %}
            {% include components/button.html href=opportunity.apply_url label=action_label variant=action_variant size="sm" icon_right="→" %}
        {% elsif status == "filled" %}
            <span class="opportunity-card__closed">Applications closed</span>
        {% endif %}
    </div>
</article>
