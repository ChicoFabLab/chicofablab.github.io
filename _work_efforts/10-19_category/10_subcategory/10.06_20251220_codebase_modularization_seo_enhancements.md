---
title: "Codebase Modularization & SEO Enhancements"
status: "completed"
created: "2025-12-20T06:20:24.428Z"
last_updated: "2025-12-21T03:46:08.917Z"
---

# Work Effort: Codebase Modularization & SEO Enhancements

## Objective
Modularize the monolithic CSS (10k lines) and JS (3k lines) files into maintainable Sass partials and ES modules, and add SEO/navigation features (TOC, breadcrumbs, sitemap).

## Tasks
- [x] CSS modularization: Convert main.css to Sass partials organized by feature
- [x] JS modularization: Split main.js into ES modules by functionality
- [x] Table of contents: Auto-generate TOC for long wiki pages
- [x] Breadcrumbs navigation: Add breadcrumb trail to wiki pages
- [x] Sitemap generation: Create sitemap.xml for SEO
- [x] CSS deep cleanup: Extract 6,038 lines (58.7%) from legacy to 7 new partials
- [x] Bug fix: Font switcher API call correction
- [x] Commit all changes to git (PR #5 merged, PR #6 for TOC fix)
- [ ] Further extraction: FAB bar, toasts, drawer (~1,500 more lines potential)

## Progress
- 12/20/2025: ### Phase 11: Aggressive Mobile Layout Enhancement - COMPLETED (2025-12-20 19:20 PST)

**Files Modified**:
- `_sass/features/_opportunities.scss` - Compact cards, prominent badges, sticky filter improvements
- `_sass/features/_wiki.scss` - Horizontal scroll pills, compact hero, tighter sections
- `_sass/features/_mobile-nav.scss` - Better typography, compact content areas
- `_sass/components/_cards.scss` - Compact wiki cards, better touch targets
- `_sass/_base.scss` - Mobile-first typography, better line-height
- `assets/js/main.js` - Sticky filter shadow on scroll, requirements expand/collapse

**Changes Made**:
1. ✅ **Compact opportunity cards**: Reduced padding (1rem → 0.75rem), tighter gaps, bolder left borders
2. ✅ **Enhanced status badges**: Solid color backgrounds (green/red/yellow), larger font, more prominent
3. ✅ **Collapsible requirements**: Shows 2 items on mobile with "+ X more" to expand
4. ✅ **Sticky filter improvements**: Shadow/blur on scroll, larger touch targets, better fade edges
5. ✅ **Wiki cards optimization**: Smaller padding, 2-line clamp on excerpts, compact headers
6. ✅ **Typography refinements**: Mobile-first base font (16px), tighter line-height, smaller headings
7. ✅ **Hero sections**: 40% smaller padding on mobile, compact stats
8. ✅ **Category pills**: Horizontal scroll with snap, min-height 36px touch targets
9. ✅ **Description clamping**: 2-line max on mobile for better scannability

**Build Verification**: ✅ No lint errors
- 12/20/2025: ### Phase 11: Aggressive Mobile Layout Enhancement - IN PROGRESS (2025-12-20 19:10 PST)

**Objective**: Dramatically improve mobile responsiveness, ease of use, and content parsing.

**Planned Changes**:
1. Compact card mode for mobile (reduce padding, collapsible requirements)
2. Enhanced visual hierarchy (prominent status badges, bold borders)
3. Sticky filter improvements (shadow/blur on scroll, larger touch targets)
4. Wiki grid enhancements (compact cards, badge-first layout)
5. Typography & spacing polish (optimized font sizes, consistent rhythm)
- 12/20/2025: ### Phase 10: CSS Extraction - FAB Bar & Settings Menu - COMPLETED (2025-12-20 10:45 PST)

**Extracted Components**:
1. **FAB Bar** → `_sass/features/_fab-bar.scss` (~170 lines)
   - Unified floating action bar with expandable items
   - Achievement notification dots
   - Tooltip labels and animations

2. **Settings Menu** → `_sass/components/_settings-menu.scss` (~200 lines)
   - Vertical dropdown menu
   - Accordion sections
   - Color swatches and select dropdowns
   - Mobile responsive styles

**Results**:
- **Before**: `_legacy.scss` = 4,232 lines
- **After**: `_legacy.scss` = 3,654 lines
- **Reduction**: 578 lines (**13.7% smaller**)
- **Total reduction so far**: 6,616 lines (from original 10,270 lines = **64.4% reduction**)

**New Partials Created**:
- `features/_fab-bar.scss` (170 lines)
- `components/_settings-menu.scss` (200 lines)

**Files Modified**:
- `assets/css/main.scss` - Added imports for new partials
- `_sass/_legacy.scss` - Removed extracted code

**Build Verification**: ✅ Jekyll build successful (0.604s)
- 12/20/2025: ### Phase 9: Mobile Layout Improvements - COMPLETED (2025-12-20 10:20 PST)

**Changes**: Mobile-responsive enhancements across multiple components.

**Files Modified**:
- `_sass/components/_forms.scss` - Mobile-friendly form styles
- `_sass/features/_toc.scss` - Responsive TOC behavior
- `_sass/features/_wiki.scss` - Mobile wiki layout improvements
- `_sass/utilities/_utility-classes.scss` - Responsive utility classes
- `assets/js/main.js` - Font switcher fixes
- `_data/settings.yml` - Settings configuration update

**Commit**: `d6547f1` - "fix: mobile layout improvements and responsive enhancements"
**Branch**: `fix/mobile-layout`
**Status**: ✅ Committed and pushed to remote

### Phase 8: TOC Layout Fix - COMPLETED (2025-12-20 09:15 PST)

**Issue**: "On this page" TOC sidebar overlapping content on API Reference page.

**Root Cause**: CSS Grid wasn't explicitly positioning elements - TOC and content were auto-placed incorrectly.

**Fix Applied** (`_sass/features/_toc.scss`):
1. Added explicit `grid-column: 1` and `grid-row: 1` to `.toc-content`
2. Added explicit `grid-column: 2` and `grid-row: 1` to `.cfl-toc`
3. Removed conflicting `float: right`
4. Widened TOC from 220px → 260px

**Cleanup**: Removed 130+ duplicate TOC lines from `_legacy.scss`

**PR**: #6

---

### Phase 7: Font Switcher Bug Fix - COMPLETED (2025-12-20 08:41 PST)

**Issue**: Font switcher in settings drawer not applying fonts correctly.

**Root Cause**: Drawer's font select was calling `window.CFLSettings.setFont()` but the actual API is `window.CFL.setFont()`.

**Fix Applied** (`assets/js/main.js`):
1. Corrected API call from `CFLSettings.setFont()` → `CFL.setFont()`
2. Added bi-directional sync for all font select elements
3. Sync on init to match persisted state

**Verification**: ✅ Jekyll build successful, fonts apply correctly.

---

### Phase 6: CSS Deep Cleanup - COMPLETED (2025-12-19 23:15 PST)

### NEW PARTIALS CREATED:
| Partial | Lines | Purpose |
|---------|-------|---------|
| `features/_fun-buttons.scss` | 1,501 | Rainbow, neon, glitch, 30+ animated button styles |
| `components/_forms.scss` | 1,210 | Sliders, selects, radios, checkboxes |
| `utilities/_utility-classes.scss` | 1,192 | Spacing, typography, display utilities |
| `features/_loaders.scss` | 781 | Skeleton, spinner, dot, bar loaders |
| `features/_achievements.scss` | 241 | Achievement rarity/tier system |
| `features/_eldritch.scss` | 102 | Void corruption mode effects |
| `features/_showcase.scss` | 88 | Component showcase page styles |

### FINAL RESULTS:
- **Original `_legacy.scss`**: 10,270 lines
- **Final `_legacy.scss`**: 4,232 lines
- **Total reduction**: 6,038 lines (**58.7% smaller**)

### SASS ARCHITECTURE (21 partials):
```
_sass/
├── _variables.scss (40)
├── _themes.scss (92)
├── _base.scss (168)
├── _layout.scss (264)
├── _legacy.scss (4,232) ← Remaining un-extracted code
├── components/
│   ├── _alerts.scss (108)
│   ├── _badges.scss (103)
│   ├── _buttons.scss (124)
│   ├── _cards.scss (203)
│   └── _forms.scss (1,210) ← NEW
├── features/
│   ├── _achievements.scss (241) ← NEW
│   ├── _eldritch.scss (102) ← NEW
│   ├── _fun-buttons.scss (1,501) ← NEW
│   ├── _loaders.scss (781) ← NEW
│   ├── _marquee.scss (42)
│   ├── _search.scss (65)
│   ├── _showcase.scss (88) ← NEW
│   ├── _toc.scss (133)
│   └── _wiki.scss (305)
└── utilities/
    ├── _accessibility.scss (44)
    ├── _print.scss (112)
    └── _utility-classes.scss (1,192) ← NEW
```

### BUILD VERIFICATION:
✅ Jekyll build: Successful (2.45s)
✅ All 21 partials compile correctly
✅ No CSS errors
- 12/19/2025: ## Phase 6: CSS Cleanup - COMPLETED (2025-12-19 23:00 PST)

### Changes Made:
1. **Updated main.scss** - Now properly imports all extracted partials before legacy
2. **Removed duplicates from _legacy.scss**:
   - Removed skip-link, reading-time, wiki-meta, last-updated (~60 lines)
   - Removed :root variables and theme definitions (~140 lines)
   - Removed marquee styles (~40 lines)
   - Removed header/nav layout (~50 lines)
   - Removed hero section (~80 lines)
   - Removed wiki-section, wiki-search (~90 lines)
   - Removed category-pills (~80 lines)
   - Removed wiki-card/card-* styles (~200 lines)
   - Removed cfl-btn base component (~130 lines)

### Results:
- **_legacy.scss**: 10,270 → 9,326 lines (**944 lines removed**, 9.2% reduction)
- **Jekyll build**: ✅ Successful (0.941 seconds)
- **Compiled CSS**: 12,397 lines (includes all partials + legacy)

### Files Modified:
- `assets/css/main.scss` - Updated import structure
- `_sass/_legacy.scss` - Removed duplicate sections

### Import Order (main.scss):
1. variables → themes (design tokens)
2. base (reset, typography)
3. layout (header, footer, main)
4. components/* (buttons, alerts, badges, cards)
5. features/* (wiki, search, marquee, toc)
6. utilities/* (accessibility, print)
7. legacy (remaining un-extracted styles)
- 12/19/2025: ## Phase 1-5 Complete (Prior Session):
- ✅ CSS modularization: Created _sass/ with 14 partials (variables, themes, base, layout, components/*, features/*, utilities/*)
- ✅ JS modularization: Created assets/js/modules/ with 5 ES modules (storage, dark-mode, keyboard, drawer, index)
- ✅ Table of contents: Created _includes/toc.html with auto-generated headings
- ✅ Breadcrumbs: Created _includes/auto-breadcrumbs.html
- ✅ Sitemap: Added jekyll-sitemap plugin to Gemfile and _config.yml

## Phase 6: CSS Cleanup (Current - 2025-12-19 22:45 PST)
- [ ] Update main.scss to import extracted partials (not just legacy)
- [ ] Remove duplicate code from _legacy.scss (~2,000 lines of duplicates identified)
- [ ] Test Jekyll build
- [ ] Verify styling intact
- Created 12/19/2025

## Next Steps

### Immediate (Ready Now)
1. **Commit all changes** - 21 new/modified files ready to commit
2. **Verify site locally** - Test font switcher, themes, all components

### Optional Further Extraction
Remaining in `_legacy.scss` (~4,232 lines):
- FAB bar component (~400 lines)
- Settings drawer styles (~300 lines)
- Toast notifications (~200 lines)
- Drawer component (~250 lines)
- Various page-specific styles (~350 lines)

**Potential additional reduction**: ~1,500 lines (36% of remaining)

### Future Considerations
- Migrate from Sass `@import` to `@use` (addresses deprecation warnings)
- Integrate JS modules into main.js build pipeline
- Add CSS source maps for debugging
