---
title: "Codebase Modularization & SEO Enhancements"
status: "active"
created: "2025-12-20T06:20:24.428Z"
last_updated: "2025-12-20T08:41:45.000Z"
---

# Work Effort: Codebase Modularization & SEO Enhancements

## Objective
Modularize the monolithic CSS (10k lines) and JS (3k lines) files into maintainable Sass partials and ES modules, and add SEO/navigation features (TOC, breadcrumbs, sitemap).

## Tasks
- [x] CSS modularization: Convert main.css to Sass partials organized by feature
- [x] JS modularization: Split main.js into ES modules by functionality
- [x] Table of contents: Auto-generate TOC for long wiki pages
- [x] Breadcrumbs navigation: Add breadcrumb trail to wiki pages
- [x] Sitemap generation: Create sitemap.xml for SEO
- [x] CSS deep cleanup: Extract 6,038 lines (58.7%) from legacy to 7 new partials
- [x] Bug fix: Font switcher API call correction
- [ ] Commit all changes to git
- [ ] Further extraction: FAB bar, toasts, drawer (~1,500 more lines potential)

## Progress

### Phase 7: Font Switcher Bug Fix - COMPLETED (2025-12-20 08:41 PST)

**Issue**: Font switcher in settings drawer not applying fonts correctly.

**Root Cause**: Drawer's font select was calling `window.CFLSettings.setFont()` but the actual API is `window.CFL.setFont()`.

**Fix Applied** (`assets/js/main.js`):
1. Corrected API call from `CFLSettings.setFont()` → `CFL.setFont()`
2. Added bi-directional sync for all font select elements
3. Sync on init to match persisted state

**Verification**: ✅ Jekyll build successful, fonts apply correctly.

---

### Phase 6: CSS Deep Cleanup - COMPLETED (2025-12-19 23:15 PST)

### NEW PARTIALS CREATED:
| Partial | Lines | Purpose |
|---------|-------|---------|
| `features/_fun-buttons.scss` | 1,501 | Rainbow, neon, glitch, 30+ animated button styles |
| `components/_forms.scss` | 1,210 | Sliders, selects, radios, checkboxes |
| `utilities/_utility-classes.scss` | 1,192 | Spacing, typography, display utilities |
| `features/_loaders.scss` | 781 | Skeleton, spinner, dot, bar loaders |
| `features/_achievements.scss` | 241 | Achievement rarity/tier system |
| `features/_eldritch.scss` | 102 | Void corruption mode effects |
| `features/_showcase.scss` | 88 | Component showcase page styles |

### FINAL RESULTS:
- **Original `_legacy.scss`**: 10,270 lines
- **Final `_legacy.scss`**: 4,232 lines
- **Total reduction**: 6,038 lines (**58.7% smaller**)

### SASS ARCHITECTURE (21 partials):
```
_sass/
├── _variables.scss (40)
├── _themes.scss (92)
├── _base.scss (168)
├── _layout.scss (264)
├── _legacy.scss (4,232) ← Remaining un-extracted code
├── components/
│   ├── _alerts.scss (108)
│   ├── _badges.scss (103)
│   ├── _buttons.scss (124)
│   ├── _cards.scss (203)
│   └── _forms.scss (1,210) ← NEW
├── features/
│   ├── _achievements.scss (241) ← NEW
│   ├── _eldritch.scss (102) ← NEW
│   ├── _fun-buttons.scss (1,501) ← NEW
│   ├── _loaders.scss (781) ← NEW
│   ├── _marquee.scss (42)
│   ├── _search.scss (65)
│   ├── _showcase.scss (88) ← NEW
│   ├── _toc.scss (133)
│   └── _wiki.scss (305)
└── utilities/
    ├── _accessibility.scss (44)
    ├── _print.scss (112)
    └── _utility-classes.scss (1,192) ← NEW
```

### BUILD VERIFICATION:
✅ Jekyll build: Successful (2.45s)
✅ All 21 partials compile correctly
✅ No CSS errors
- 12/19/2025: ## Phase 6: CSS Cleanup - COMPLETED (2025-12-19 23:00 PST)

### Changes Made:
1. **Updated main.scss** - Now properly imports all extracted partials before legacy
2. **Removed duplicates from _legacy.scss**:
   - Removed skip-link, reading-time, wiki-meta, last-updated (~60 lines)
   - Removed :root variables and theme definitions (~140 lines)
   - Removed marquee styles (~40 lines)
   - Removed header/nav layout (~50 lines)
   - Removed hero section (~80 lines)
   - Removed wiki-section, wiki-search (~90 lines)
   - Removed category-pills (~80 lines)
   - Removed wiki-card/card-* styles (~200 lines)
   - Removed cfl-btn base component (~130 lines)

### Results:
- **_legacy.scss**: 10,270 → 9,326 lines (**944 lines removed**, 9.2% reduction)
- **Jekyll build**: ✅ Successful (0.941 seconds)
- **Compiled CSS**: 12,397 lines (includes all partials + legacy)

### Files Modified:
- `assets/css/main.scss` - Updated import structure
- `_sass/_legacy.scss` - Removed duplicate sections

### Import Order (main.scss):
1. variables → themes (design tokens)
2. base (reset, typography)
3. layout (header, footer, main)
4. components/* (buttons, alerts, badges, cards)
5. features/* (wiki, search, marquee, toc)
6. utilities/* (accessibility, print)
7. legacy (remaining un-extracted styles)
- 12/19/2025: ## Phase 1-5 Complete (Prior Session):
- ✅ CSS modularization: Created _sass/ with 14 partials (variables, themes, base, layout, components/*, features/*, utilities/*)
- ✅ JS modularization: Created assets/js/modules/ with 5 ES modules (storage, dark-mode, keyboard, drawer, index)
- ✅ Table of contents: Created _includes/toc.html with auto-generated headings
- ✅ Breadcrumbs: Created _includes/auto-breadcrumbs.html
- ✅ Sitemap: Added jekyll-sitemap plugin to Gemfile and _config.yml

## Phase 6: CSS Cleanup (Current - 2025-12-19 22:45 PST)
- [ ] Update main.scss to import extracted partials (not just legacy)
- [ ] Remove duplicate code from _legacy.scss (~2,000 lines of duplicates identified)
- [ ] Test Jekyll build
- [ ] Verify styling intact
- Created 12/19/2025

## Next Steps

### Immediate (Ready Now)
1. **Commit all changes** - 21 new/modified files ready to commit
2. **Verify site locally** - Test font switcher, themes, all components

### Optional Further Extraction
Remaining in `_legacy.scss` (~4,232 lines):
- FAB bar component (~400 lines)
- Settings drawer styles (~300 lines)
- Toast notifications (~200 lines)
- Drawer component (~250 lines)
- Various page-specific styles (~350 lines)

**Potential additional reduction**: ~1,500 lines (36% of remaining)

### Future Considerations
- Migrate from Sass `@import` to `@use` (addresses deprecation warnings)
- Integrate JS modules into main.js build pipeline
- Add CSS source maps for debugging
